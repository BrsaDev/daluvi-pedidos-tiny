<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
            integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Karla:wght@300;500&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./css/home.css">
        <title>Order Tiny</title>
    </head>
    <body>
        <div class="container-fluid h-100">
            <div class="row h-100">
                <div class="col-2 bg-my-blueligth">
                    <div class="d-flex flex-column align-items-center mt-5 pointer">
                        <i class="fas fa-boxes my-fs-3 text-white"></i>
                        <span class="text-white my-fs-5 fw-my-bold">Produtos</span>
                    </div>
                </div>
                <div class="col-10 bg-my-gray my-p-5">
                    <div id="cadastro-sku" class="w-100">
                        <div class="w-100">
                           <label class="fs-3 fw-bold text-center text-md-left">Interligação de código da plataforma com sku</label>
                        </div>
                        <div class="mt-3 card card-body bg-transparent shadow-sm">
                            <div class="row">
                               <div class="form-group col-12 col-md-6">
                                    <label>PlanKey</label>
                                    <input autofocus type="text" id="key" class="form-control form-control-sm">
                                </div>
                                <div class="form-group col-12 col-md-6">
                                    <label>Sku</label>
                                    <input type="text" id="sku" class="form-control form-control-sm">
                                </div> 
                            </div>
                            <div class="row mt-2">
                                <div class="form-group col-12 col-md-6">
                                     <label>Produto</label>
                                     <input autofocus type="text" id="produto" class="form-control form-control-sm">
                                 </div>
                            </div>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="upsell">
                                <label class="form-check-label">
                                  É upsell
                                </label>
                            </div>
                            <div class="row mt-2 gap-2">
                                <div>
                                    <button onclick="cadastrarSku()" class="btn btn-sm btn-primary fw-bold col-12 col-md-2 mt-3">Interligar</button>
                                    <button id="btn-listagem-skus" onclick="listarSkus()" class="btn btn-sm btn-success fw-bold col-12 col-md-2 mt-3">Listar Skus</button>
                                    <button id="btn-esconder-skus" onclick="listarSkus()" class="d-none btn btn-sm btn-warning fw-bold col-12 col-md-2 mt-3">Esconder Skus</button>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <!-- abaixo secção de listagem -->
                    <div id="listagem-skus" class="mt-3 d-none">
                        <h4>Listagem de Skus</h4>
                        <div class="row">
                            <div class="col-auto w-100">
                                <div class="shadow-sm">
                                    <div class="h-table card-body overflow-auto scroll pt-0">
                                        <table class="table table-sm table-hover table-bordered rem0788">
                                            <thead>
                                                <tr class="text-center text-nowrap text-light bg-primary sticky">
                                                    <th scope="col">Key</th>
                                                    <th scope="col">Sku</th>
                                                    <th scope="col">Produto</th>
                                                    <th scope="col">Upsell</th>
                                                    <th scope="col"></th>
                                                    <th scope="col"></th>
                                                    <th scope="col"></th>
                                                    <th scope="col"></th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                
            </div>
        </div>
        <script>
            let key = document.querySelector("#key")
            let sku = document.querySelector("#sku")
            let produto = document.querySelector("#produto")
            let upsell = document.querySelector("#upsell")
            let tbody = document.querySelector("#tbody")
            let listagemSkus = document.querySelector("#listagem-skus")
            let btnListagemSkus = document.querySelector("#btn-listagem-skus")
            let btnEsconderSkus = document.querySelector("#btn-esconder-skus")
            async function cadastrarSku() {
                let erros = []
                if ( key.value == "" ) erros.push("PlanKey não pode ser vazio.")
                if ( sku.value == "" ) erros.push("Sku não pode ser vazio.")
                if ( produto.value == "" ) erros.push("Produto não pode ser vazio.")
                if ( erros.length > 0 ) return alert(erros[0])

                let response = await axios.post("http://localhost:3005/cadastrar-sku", {
                    key: key.value, 
                    sku: sku.value,
                    produto: produto.value,
                    upsell: upsell.checked
                })
                if ( response.data.resultado ) {
                    tbody.innerHTML += `
                        <tr class="text-nowrap">
                            <td scope="col" class="text-center">${response.data.resultado.key}</td>
                            <td scope="col" class="text-center">${response.data.resultado.sku}</td>
                            <td scope="col" class="text-center">${response.data.resultado.produto}</td>
                            <td scope="col" class="text-center">${(response.data.resultado.upsell?"Sim": "Não")}</td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                        </tr>
                    `
                    key.value = ""
                    sku.value = ""
                    produto.value = ""
                    upsell.checked = false
                    return alert("Sku cadastrado com sucesso.")
                }
                if ( response.data.erro && response.data.msg == "Valores vazios." ) {
                    return alert("Preencha corretamente os campos para enviar.")
                }
                if ( response.data.erro && response.data.msg == "Sku já cadastrado" ) {
                    return alert("Este sku já está cadastrado.")
                }
                if ( response.data.erro && response.data.msg == "Key já cadastrado" ) {
                    return alert("Este key já está cadastrado.")
                }
                if ( response.data.erro ) {
                    return alert("Houve um erro no cadastro, fale com o suporte.")
                }
            }
            function listarSkus() {
                if ( listagemSkus.classList.toString().includes('d-none') ) {
                    listagemSkus.classList.remove('d-none')
                    btnListagemSkus.classList.add('d-none')
                    btnEsconderSkus.classList.remove('d-none')
                }else { 
                    listagemSkus.classList.add('d-none')
                    btnListagemSkus.classList.remove('d-none')
                    btnEsconderSkus.classList.add('d-none')
                }
            }
            async function getSkus() {
                let response = await axios("http://localhost:3005/buscar-skus")
                let lista = ""
                if ( response.data.skus ) {
                    for ( let item of response.data.skus ) {
                        lista += `
                        <tr class="text-nowrap">
                            <td scope="col" class="text-center">${item.key}</td>
                            <td scope="col" class="text-center">${item.sku}</td>
                            <td scope="col" class="text-center">${item.produto}</td>
                            <td scope="col" class="text-center">${(item.upsell?"Sim": "Não")}</td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                            <td scope="col" class="col-vazia"></td>
                        </tr>
                        `
                    }
                }
                tbody.innerHTML = lista
            }
            getSkus()
            
        </script>
    </body>
</html>